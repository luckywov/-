# 程序思路

## 1、地图生成

炸弹人较难的部分是考虑地图的生成布局，地图的整体大小是固定不变的，地图主要由三个部分组成：

墙、道具、怪物

墙体生成：用二维数组记录地图行列数，在地图中有两种不同状态的墙体：可炸毁和不可炸毁

​	不可炸毁墙体：在地图中按规律分布，我们可以利用该规律生成墙体。用二维数组来表示整张地图的话，记左下角为[0]\[0],则不可炸毁的墙体所在为位置的数组小标均为奇数。

​	注意：地图外围有一圈不可炸毁的墙体我们不记在数组内部

```伪代码
for(x=-1;x<列数+1;x++)
{
  for(y=-1;y<行数+1;y++)
  {
    if( (x%2==1&y%2==1)|x==-1|x==列数|y==-1|y==函数)//数组下标均为奇数或最外围墙体
    生成不可炸毁墙体
  }
}
```

​	可炸毁的墙体：随机分布在地图空闲的地方，我们需要建立一个当前地图内空闲位置的列表。

数组内偶数行和偶数列即所选范围（添加判断语句if(x%2==0|y%2==0)）再利用随机数再空闲位置生成一定数量可摧毁的墙体。

​	一般来说，炸弹人会在游戏开始时生成在地图的左上角，因而我们要给主角一定的生存空间。这里我们将左上角三个位置作为保留，这三个位置是不可以生成可摧毁墙体的。



​	道具/门的生成：当我们随机生成一些可炸毁墙体后，系统检测存有可炸毁墙体的位置列表，将道具随机赋予给其中1个或2个墙体，当墙体被炸毁时，道具显示。玩家拾取道具后可改变玩家类的一些信息，这个稍后会讲。



## 2、炸弹管理

​	炸弹人中另一个较为重要的部分是炸弹爆炸的运算。

​	建立一个炸弹类，在炸弹上设置一个定时器。在生成炸弹前提前检测当前位置是否已经存在炸弹或墙体，有则无法生成炸弹。

​	炸弹计时器结束后调用火焰类，火焰类中包含定时器以及爆炸范围等信息。在火焰类定时器工作时间内，存在于爆炸范围内的一切物体都将被摧毁（不可摧毁墙体除外），爆炸范围利用遍历算法，以炸弹位置为中心向上下左右四周进行遍历，中途如果遇到墙体时，该方向上的遍历结束。

```伪代码
一个方向上的火焰类遍历
for(int i = 0;i<威力;i++)
{
  if(没有墙体)
  	炸弹放置坐标a[x+i][y].火焰显示 = true;
  else if(有可摧毁墙体)
  {
    可摧毁墙体被摧毁;
    break;
  }
  else
  	break;
}
```



## 3、怪物管理

与道具生成恰恰相反，怪物生成时需检测地图中没有墙体的位置，利用随机数分布于这些位置中，然后开始运动。	

怪物在运动过程中不断检测其运动方向上是否有障碍，一遇到障碍九通过随机数指定一个新方向进行运动



## 4、游戏管理

​	游戏有一个整体的计时器，在游戏初始化以后开始计时，如果在倒计时结束前玩家没有消灭所有敌人并且打开传送门，则游戏结束

​	玩家拥有生命值，用int变量记录。玩家每死亡一次，地图内所有场景都将全部重新加载。如果消灭所有敌人之前，玩家生命值降为0，则游戏提前结束，反之游戏进入下一关。



## 5、游戏流程图

![img](file:///C:\Users\流星画魂\Documents\Tencent Files\1214593142\Image\C2C\71632D09223F0F4B7BCAEBC6BE8DE05B.jpg)