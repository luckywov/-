# 俄罗斯方块游戏实现思路

## 1. 随机生成方块

用一个数组存放7种方块组，用生成随机数的方式选择生成方块组形状

## 2. 地图的生成

将场景看作是一个10*20的二维数组，每一个小方块占1个单位。

每个格子在数组中的索引号为这个格子的坐标

## 3.判断方块是否都在边界内

左右移动方块时，获取方块组中每个子方块的坐标以及边界的坐标，进行比较以判断方块组是否在边界内。若是在边界内，更新方块组的坐标数据

```伪代码
for(每个子方块)
{
	if(方块X坐标>左边界的X坐标&&方块X坐标<右边界的X坐标)
	{
      return false;//超出边界
	}
	return true;//在边界内
}
```

对于旋转导致超出边界的情况

解决办法如下：

- 不能旋转。旋转后遍历方块组每个方块，判断是否都在边界内，若子方块不再边界内，再反方向旋转回去，这种方式再视觉上看起来就好像方块组被冻结，无法旋转
- 能够旋转。在旋转后，遍历方块组所有子方块，如果有方块的位置不在边界内，则将每个子方块的坐标向边界内移动，这种情况称为旋转踢墙

## 4. 判断是否碰到其他方块
循环遍历网格数组，检测方块组要到达的地方是否为空，若为空，则继续移动，更新方块位置的坐标数据，若不为空，则停止移动


## 5.检查是否满行
在地图中，位于同一行的方块的y坐标相同，遍历数组中y坐标相同的数据是否为空。若都不为空，则表示y坐标为y的一行被填满。
```伪代码
//输入要检测的行的高度y;
for(int x=0;x<宽度;x++)
{
  if((x,y)位置上没有方块)
  return false;
  return true;
}
```

## 6. 删除填满的行

删除该行数组的元素，即将数组中该行的数据全部置为空。再遍历上面所有行，数组中的所有元素的y坐标减1，达到下落的效果。

for(int y=0;y<height;y++)

{

​	if(高度为y的一行被填满)

​	{

​	删除y行的所有元素;

​	遍历y行上面所有的行，将上面所有的行的y坐标-1;

​	}

}   

## 7. 提示下一个方块组

判断是否时是第一次生成方块，若是，则产生两个随机数，一个是当前方块组的编号，一个是下一个方块组的编号。若不是，则将当前的编号置为下一个方块组的编号，再产生一个随机数表示表示下一个方块组的编号

```伪代码
bool isFirst = true;
int currentNum = 0; //当前方块的编号
int nextNum = 0;    //下一个方块组的编号
if(isFirst)
{
  currentNum=方块组数组长度内的一个随机数;
  nextNum = 方块组数组长度内的一个随机数;
  isFirst = false;
}
else
{
  currentNum = nextNum;
  nextNum=方块数组长度内的一个随机数;
}
产生编号为currentNUm的方块组
绘制编号为next的方块组
```



## 8.结束判定

获取产生的方块组的坐标，判断方块组中的子方块的坐标是否超过上边界，如果超出上边界，则游戏结束，如果没有超出上边界，则游戏继续。

## 9.流程图

![img](file:///C:\Users\流星画魂\Documents\Tencent Files\1214593142\Image\C2C\DC434370724881CD3441348C52CF6ABC.jpg)



