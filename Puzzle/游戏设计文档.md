# 游戏思路

1、原图与图片的对应关系

以3*3九宫格为例，可以将构成原图的9个碎片图片用不同的整数（如1、2、3、4、5、6、7、8、9）来表示，

并保存在一个3*3的二维数组中

假设碎片的宽度为w，高度为h，碎片的中心点位置即碎片的位置坐标，二维数组的第一个元素图片位于地图的左下角。

当原图的左下角坐标在世界坐标的原点时，即(0,0)位置，假设当前图片在二维数组索引号为[i]\[j],那么当前碎片的具体位置公式如下：

​     	 x=(i+1/2)*w

​      	 y=(j+1/2)*h

例如索引号为[2]\[2]的坐标可以根据上述公式求出为(5/2\*w,5/2\*h)

如果原图的中心在世界坐标系的原点，那么此时公式为：

​	x=(j-1)*w

​	y=(i-1)*h



2、鼠标拖拽移动碎片

鼠标拖拽移动碎片的功能包括一下几个功能

- 判断鼠标点击的位置是否在碎片内：

  当鼠标点击左键时，获取鼠标的屏幕坐标，因为碎片的位置是在世界坐标系下的，所以需要把鼠标的屏幕位置坐标转化为世界坐标，使得它们在同一坐标系下，这样它们的数值才具有可比性。获取碎片的左下角坐标

  (Sx,Sy),根据碎片的宽度与高度，可以得到这张碎片的内部坐标范围，即(Sx<x<Sx+w,Sy<y<Sy+h).若鼠标的世界坐标位置在此范围内，则可以判定碎片被选中

- 实现被拖拽的碎片跟随鼠标移动：

  在鼠标拖拽的过程中，先获得当前鼠标的屏幕坐标位置，因为需要与碎片的坐标系统保持同一，因此还需要把鼠标的屏幕位置坐标转化为世界坐标。

  可通过如下公式实现鼠标跟随效果：

  碎片坐标=鼠标的世界坐标+碎片位置与鼠标位置的偏移量

- 鼠标松开时。获取碎片当前的坐标，与对应的正确的位置坐标进行距离判断比较，我们可以设置一个临界值，如果它们之间的距离小于这个临界值，那么可以认为碎片靠近了对应的正确位置，将碎片放置到正确的位置上，否则碎片会回到碎片池子里。

3、正确判断

如果图片靠近了对应的正确位置，那么把该碎片自动放置到正确的位置

我们可以通过计算碎片与正确位置的距离来判断碎片是否靠近了正确的位置，设：A(x1,y1) B(x2,y2)分别表示碎片和对应的正确位置，我们可以通过如下公式计算它们之间的距离

​		|A*B| = sqrt( ( x1 - x2 ) ^ 2 + ( y1 - y2 ) ^ 2 )

考虑到要进行开根号的计算会消耗更多的计算资源，因此我们用距离平方来计算

即|A*B|^2.但我们也可以使用更简单的方法来判断碎片是否接近正确的位置，即获取碎片的坐标 (Sx,Sy)与碎片对应的正确位置的坐标(Tx,Ty)，若|Tx-Sx|<临界值&&|Ty-Sy|<临界值 则判定碎片靠近了对应的正确位置，将碎片的位置修改为(Tx,Ty)。若没有靠近，则将碎片返回初始位置

```伪代码
if(|Tx-Sx|<临界值&&|Ty-Sy|<临界值)
{
  碎片坐标 = 正确坐标;
}
else
{
  碎片回到原来的位置
}
```



4、获胜判断

当所有碎片都被放置在正确的位置上，则判定游戏结束。那么要怎么判断所有的碎片都放置到了正确的位置呢？

我们可以设计一个用来计数的变量，每当一个碎片被放置到正确的位置后，该变量就加一，当这个变量值等于碎片的总数时，就说明，所有的碎片都放置到了正确的位置，这时，就可以判定游戏结束



5、游戏流程图

![img](file:///C:\Users\流星画魂\Documents\Tencent Files\1214593142\Image\C2C\3B37D4FA59B1CE7769ED30A251C63816.jpg)

